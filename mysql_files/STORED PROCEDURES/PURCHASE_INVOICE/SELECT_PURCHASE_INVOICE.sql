
DELIMITER //
CREATE PROCEDURE SELECT_PURCHASE_INVOICE(IN PURCHASE_INVOICE_NUM_PARAM VARCHAR(50))
BEGIN
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
ROLLBACK;
RESIGNAL;
END;
START TRANSACTION;
SELECT CREDITOR_NUM, CREDITOR_NAME, CREDITOR_ADDRESS, PURCHASE_INVOICE_NUM,PURCHASE_INVOICE_DATE,PURCHASE_INVOICE_DESC,purchase_invoice.GL_ACC_NUM,PURCHASE_INVOICE_NUM AS PURCHASE_INVOICE_NUM_OLD FROM creditor JOIN purchase_invoice USING (CREDITOR_NUM) WHERE PURCHASE_INVOICE_NUM=PURCHASE_INVOICE_NUM_PARAM;
SELECT PURCHASE_INVOICELINE_LINENUMBER,PURCHASE_INVOICELINE_STOCK_NUM,PURCHASE_INVOICELINE_STOCK_DESC,PURCHASE_INVOICELINE_STOCK_PRICE,PURCHASE_INVOICELINE_STOCK_QTY,PURCHASE_INVOICELINE_DISCOUNT FROM purchase_invoiceline WHERE PURCHASE_INVOICE_NUM=PURCHASE_INVOICE_NUM_PARAM;
COMMIT;
END//